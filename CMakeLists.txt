#
# project: MOWTHREAD
#
cmake_minimum_required(VERSION 2.8)
if (ENABLE_UBSAN)
	add_compile_options( -fsanitize=undefined )
	add_link_options( -fsanitize=undefined )
endif()
if (ENABLE_MSAN)
	add_compile_options( -fsanitize=memory -fsanitize-memory-track-origins=2 -fno-omit-frame-pointer -fsanitize-memory-use-after-dtor )
	add_link_options( -fsanitize=memory -fsanitize-memory-track-origins=2 -fno-omit-frame-pointer -fsanitize-memory-use-after-dtor )
endif()
if (ENABLE_TSAN)
	add_compile_options( -fsanitize=thread )
	add_link_options( -fsanitize=thread )
endif()
if (ENABLE_LSAN)
	add_compile_options( -fsanitize=leak )
	add_link_options( -fsanitize=leak )
endif()
if (ENABLE_ASAN)
	add_compile_options( -fsanitize=address -fno-omit-frame-pointer )
	add_link_options( -fsanitize=address -fno-omit-frame-pointer )
endif()
if (ENABLE_ALSAN)
   	add_compile_options( -fsanitize=address )
	add_link_options( -fsanitize=address )
#	ASAN_OPTIONS=detect_leaks=1
endif()
# include the fips main cmake file
get_filename_component(FIPS_ROOT_DIR "../fips" ABSOLUTE)
include("${FIPS_ROOT_DIR}/cmake/fips.cmake")

# include_directories(src)

fips_setup(PROJECT MOWTHREAD)
fips_project(mowthread)
fips_begin_app(mowthread cmdline)
fips_vs_warning_level(4)
if (FIPS_ANDROID OR FIPS_LINUX)
	add_definitions(-lpthread)
endif()
if (FIPS_MSVC)
        add_definitions(-D_CRT_SECURE_NO_WARNINGS)
endif()
if(FIPS_EMSCRIPTEN)
        add_definitions(-s FORCE_FILESYSTEM=1)
endif()
fips_files(mowthread.c mowthread.h)
if (FIPS_ANDROID)
        fips_dir(android)
        fips_files(android_native_app_glue.c android_native_app_glue.h)
        fips_libs(android log)
endif()

set(args)
if (FIPS_CLANG)
	set(args -Wno-unused-function -Wno-unused-private-field -Wno-dangling-else -Wno-unused-value -Wno-parentheses -Wno-sign-compare -Wno-deprecated-register -Wno-reorder -Wno-unused-variable)
elseif (FIPS_GCC)
	set(args -Wno-unused-function -Wno-missing-braces -Wno-unused-value -Wno-parentheses -Wno-sign-compare -Wno-unused-variable -Wno-reorder -Wno-delete-non-virtual-dtor -Wno-maybe-uninitialized -Wno-unused-but-set-variable -Wno-unused-result)
elseif (FIPS_WINDOWS)
	# 4814: he file contains a character that cannot be represented in the current code page...
	#set(args /wd4819)
	#set(args -Wx- -Wno-unused-function)
endif()

fips_end_app()
fips_finish()
